{% extends "layout.twig" %}
{% block content %}
    <h2>{% trans %}Products{% endtrans %}</h2>

    <ul class="possibilities">
        <li><a href="{{ path('admin.product.add') }}" class="button"
               title="{% trans %}Add{% endtrans %}"><span>{% trans %}Add{% endtrans %}</span></a></li>
    </ul>

    <div class="block">
        <div id="datagrid-product"></div>
    </div>

    <script type="text/javascript">

        function editProduct(dg, id) {
            location.href = "{{ path('admin.product.edit') }}/" + id;
        }

        function deleteProduct(dg, id) {
            var oRow = DataGrid.GetRow(id);
            var topic = '{% trans %}Delete{% endtrans %}';
            var msg = '{% trans %}Do you confirm deleting {% endtrans %} <strong>' + oRow.name + '</strong> ?';
            var params = {
                dg: dg,
                id: id
            };
            var func = function (p) {
                return xajax_doDeleteProduct(p.dg, p.id);
            };
            new GF_Alert(topic, msg, func, true, params);
        }

        var DataGrid;

        $(document).ready(function () {

            var column_id = new GF_Datagrid_Column({
                id: 'id',
                caption: '{% trans %}Id{% endtrans %}',
                appearance: {
                    width: 90,
                    visible: false
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var column_sku = new GF_Datagrid_Column({
                id: 'sku',
                caption: '{% trans %}SKU{% endtrans %}',
                appearance: {
                    width: 20
                },
                filter: {
                    type: GF_Datagrid.FILTER_INPUT
                }
            });

            var column_name = new GF_Datagrid_Column({
                id: 'name',
                caption: '{% trans %}Name{% endtrans %}',
                appearance: {
                    width: 70
                },
                filter: {
                    type: GF_Datagrid.FILTER_INPUT
                }
            });

            var column_ean = new GF_Datagrid_Column({
                id: 'ean',
                caption: '{% trans %}EAN{% endtrans %}',
                editable: true,
                appearance: {
                    width: 60,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_INPUT
                }
            });

            var column_hierarchy = new GF_Datagrid_Column({
                id: 'hierarchy',
                caption: '{% trans %}Hierarchy{% endtrans %}',
                editable: true,
                appearance: {
                    width: 40,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var column_sell_price = new GF_Datagrid_Column({
                id: 'sell_price',
                caption: '{% trans %}Price net{% endtrans %}',
                editable: true,
                appearance: {
                    width: 40,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var column_sell_price_gross = new GF_Datagrid_Column({
                id: 'sell_price_gross',
                caption: '{% trans %}Price gross{% endtrans %}',
                editable: true,
                appearance: {
                    width: 40,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var column_stock = new GF_Datagrid_Column({
                id: 'stock',
                caption: '{% trans %}Stock{% endtrans %}',
                editable: true,
                appearance: {
                    width: 40,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var column_weight = new GF_Datagrid_Column({
                id: 'weight',
                caption: '{% trans %}Weight{% endtrans %}',
                appearance: {
                    width: 40,
                    align: GF_Datagrid.ALIGN_RIGHT
                },
                filter: {
                    type: GF_Datagrid.FILTER_BETWEEN
                }
            });

            var options = {
                id: 'product',
                appearance: {
                    column_select: false
                },
                mechanics: {
                    key: 'id',
                    rows_per_page: 25
                },
                event_handlers: {
                    load: xajax_getProductForAjax,
                    edit_row: editProduct,
                    delete_row: deleteProduct,
                    click_row: editProduct,
                    update_row: function (sId, oRow, sColumn, sPreviousValue) {
                        xajax_doUpdateProduct({
                            id: sId,
                            product: oRow
                        }, GCallback(function (eEvent) {
                            DataGrid.LoadData();
                        }));
                    }
                },
                columns: [
                    column_id,
                    column_sku,
                    column_name,
                    column_sell_price,
                    column_sell_price_gross,
                    column_stock,
                    column_ean,
                    column_hierarchy,
                    column_weight
                ],
                row_actions: [
                    GF_Datagrid.ACTION_EDIT,
                    GF_Datagrid.ACTION_DELETE
                ],
                context_actions: [
                    GF_Datagrid.ACTION_EDIT,
                    GF_Datagrid.ACTION_DELETE
                ]
            };

            DataGrid = new GF_Datagrid($('#datagrid-product'), options);

        });
    </script>
{% endblock %}